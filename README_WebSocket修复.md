# WebSocket连接问题修复说明

## 问题描述
用户报告点击选词按钮时出现错误：`uni.offSocketOpen is not a function`

## 问题原因
1. **API方法不存在**：uni-app中不存在 `uni.offSocketOpen()` 等方法
2. **IP地址过期**：配置文件中的IP地址需要更新为 `192.168.31.195`

## 修复内容

### 1. 更新IP地址配置
- 文件：`config/config.js`
- 修改：将 `192.168.1.100` 更新为 `192.168.31.195`

### 2. 修复WebSocket事件监听器
- 文件：`pages/draw/draw.vue`
- 移除：不存在的 `uni.offSocketOpen()` 等方法调用
- 优化：在建立新连接前先关闭旧连接

### 3. 改进连接管理
- 添加了更好的连接状态管理
- 增强了错误处理和日志输出
- 优化了重连逻辑

## 测试步骤

1. **确保后端服务运行**
   ```bash
   # 在后端项目目录中启动服务
   mvn spring-boot:run
   ```

2. **检查网络连接**
   - 确保手机/模拟器与电脑在同一网络
   - 确保IP地址 `192.168.31.195` 可访问

3. **测试选词功能**
   - 进入游戏房间
   - 点击"选词"按钮
   - 查看控制台输出，应该看到：
     ```
     WebSocket连接地址: ws://192.168.31.195:8080/ws/room/xxx?token=xxx
     WebSocket连接已建立，状态更新为: true
     ```

## 调试信息

如果仍有问题，请检查控制台输出中的以下信息：
- WebSocket连接地址是否正确
- 连接状态是否为 `true`
- 是否有网络错误信息

## 常见问题

**Q: 仍然显示"网络连接异常"**
A: 检查IP地址是否正确，确保后端服务正在运行

**Q: 连接超时**
A: 检查防火墙设置，确保8080端口可访问

**Q: 选词按钮无响应**
A: 查看控制台是否有JavaScript错误，确保WebSocket已连接